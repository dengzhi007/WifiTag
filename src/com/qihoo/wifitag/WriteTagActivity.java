package com.qihoo.wifitag;import java.text.SimpleDateFormat;import java.util.Date;import java.util.Locale;import java.util.UUID;import android.app.Activity;import android.content.Intent;import android.nfc.NfcAdapter;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.ImageView;import android.widget.TextView;import android.widget.Toast;import com.qihoo.wifitag.util.DBUtil;import com.qihoo.wifitag.util.RSA;public class WriteTagActivity extends Activity {	private static SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd",Locale.SIMPLIFIED_CHINESE);	private String tagName = "";	private int encryType = 0;	private String ssid = "";	private String passwd = "";	private String createTime = null;	private boolean mode = false;	private String modeValue = "0";		private ImageView tagwrite_mode = null;	private Button tagwrite_start = null;	private boolean writeAble = false;	private View backward = null;		@Override	protected void onCreate(Bundle savedInstanceState) {		// TODO Auto-generated method stub		super.onCreate(savedInstanceState);		setContentView(R.layout.tagwrite);				Intent intent = getIntent();		ssid = intent.getStringExtra("ssid");		passwd = intent.getStringExtra("password");		tagName = intent.getStringExtra("tagname");		mode = intent.getBooleanExtra("isPrivate", false);//		makeToast(ssid + "  " + passwd) ;		DBUtil.init(this, 1);		initUI();	}		private void initUI() {		tagwrite_mode = (ImageView) findViewById(R.id.tagwrite_mode);		tagwrite_start = (Button) findViewById(R.id.tagwrite_start);				if (mode) {			tagwrite_mode.setImageResource(R.drawable.tagwrite_tips_personal);			passwd = new RSA().encrypt(passwd);			modeValue = "1";		} else {			tagwrite_mode.setImageResource(R.drawable.tagwrite_tips_public);		}				tagwrite_start.setOnClickListener(new View.OnClickListener() {			@Override			public void onClick(View v) {				// TODO Auto-generated method stub				makeToast("等待将标签贴于手机背面");				writeAble = true;			}		});				backward = findViewById(R.id.backward);		backward.setOnClickListener(new View.OnClickListener() {			@Override			public void onClick(View v) {				WriteTagActivity.this.finish();			}		});	}		@Override	protected void onResume() {		// TODO Auto-generated method stub		super.onResume();		NFCUtil.init(this);		NFCUtil.enableForeground(this);	}		private void processIntent(Intent intent) {		if (writeAble) {			if (NfcAdapter.ACTION_TAG_DISCOVERED.equals(intent.getAction())	    			||NfcAdapter.ACTION_TECH_DISCOVERED.equals(intent.getAction())	    			||NfcAdapter.ACTION_NDEF_DISCOVERED.equals(intent.getAction())) {				String[] msg = new String[]{ssid, passwd, modeValue};				if (NFCUtil.writeMessage(msg, intent)) {					createTime = sdf.format(new Date());					DBUtil.addTagInfoToDB(tagName, ssid, encryType, passwd, createTime, mode);					makeToast("成功写入" + tagName);					Intent jumpintent = new Intent(this, MyWifiTagsActivity.class);					startActivity(jumpintent);				} else {					makeToast("写" + tagName + "失败");				}			}		}		writeAble = false;	}		private void makeToast(String msg) {		Toast.makeText(this, msg, Toast.LENGTH_SHORT).show();	}		@Override	protected void onNewIntent(Intent intent) {		// TODO Auto-generated method stub		super.onNewIntent(intent);		setIntent(intent);		processIntent(intent);	}		@Override    protected void onPause() {    	// TODO Auto-generated method stub    	super.onPause();    	NFCUtil.disableForeground(this);    }}